generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DatasetStatus {
  QUEUED
  PROCESSING
  READY
  ERROR
}

model Dataset {
  id             Int           @id @default(autoincrement())
  name           String?       // можно хранить название набора
  originalName   String        // имя файла, который загрузили
  storedFilePath String        // путь на диске
  rowCount       Int           @default(0)
  status         DatasetStatus @default(QUEUED)
  progress       Int           @default(0)
  errorText      String?
  rows           DatasetRow[]

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model DatasetRow {
  id        Int      @id @default(autoincrement())
  datasetId Int
  dataset   Dataset  @relation(fields: [datasetId], references: [id], onDelete: Cascade)
  data      Json
  createdAt DateTime @default(now())

  @@index([datasetId, id], name: "DatasetRow_datasetId_id_idx")
}
